
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../python-basic/">
      
      
        <link rel="next" href="../python-pyspark/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>02 - Running from Configuration Files - GCHQ Data Quality</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="#1a237e" data-md-color-accent="#3949ab">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#data-quality-tutorial-python-2" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="GCHQ Data Quality" class="md-header__button md-logo" aria-label="GCHQ Data Quality" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            GCHQ Data Quality
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              02 - Running from Configuration Files
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="#1a237e" data-md-color-accent="#3949ab"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="#1a237e" data-md-color-accent="#90caf9"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="GCHQ Data Quality" class="md-nav__button md-logo" aria-label="GCHQ Data Quality" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    GCHQ Data Quality
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../what-is-data-quality/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    What is Data Quality?
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    00 - Installation
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../python-basic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    01 - Basic Tutorial
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    02 - Running from Configuration Files
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    02 - Running from Configuration Files
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prerequisites
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aim" class="md-nav__link">
    <span class="md-ellipsis">
      
        Aim
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-reusing-example-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Reusing Example Data
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-yaml-config-files-for-data-quality-rules" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. YAML Config Files for Data Quality Rules
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. YAML Config Files for Data Quality Rules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-yaml" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why YAML?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key structure:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example:
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lists-in-yaml" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lists in YAML
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#regex-in-yaml" class="md-nav__link">
    <span class="md-ellipsis">
      
        Regex in YAML
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-loading-and-validating-config-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Loading and Validating Config Files
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-running-a-config-against-your-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Running a Config Against Your Data
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-creating-a-config-file-from-a-report" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Creating a Config File From a Report
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-mangaing-regular-expressions" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Mangaing Regular Expressions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-tweak-output-display-advanced" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Tweak Output Display (Advanced)
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../python-pyspark/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    03 - PySpark & Nested Data
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../insights/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    04 - Insights from a Dashboard
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prerequisites
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aim" class="md-nav__link">
    <span class="md-ellipsis">
      
        Aim
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-reusing-example-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Reusing Example Data
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-yaml-config-files-for-data-quality-rules" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. YAML Config Files for Data Quality Rules
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. YAML Config Files for Data Quality Rules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-yaml" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why YAML?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key structure:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example:
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lists-in-yaml" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lists in YAML
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#regex-in-yaml" class="md-nav__link">
    <span class="md-ellipsis">
      
        Regex in YAML
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-loading-and-validating-config-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Loading and Validating Config Files
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-running-a-config-against-your-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Running a Config Against Your Data
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-creating-a-config-file-from-a-report" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Creating a Config File From a Report
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-mangaing-regular-expressions" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Mangaing Regular Expressions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-tweak-output-display-advanced" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Tweak Output Display (Advanced)
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="data-quality-tutorial-python-2">Data Quality Tutorial - Python 2</h1>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Completion of the <a href="../python-basic/"><strong>Python 1 Tutorial</strong></a> (comfortable running data quality functions on DataFrames).</li>
</ul>
<blockquote>
<p><strong>Coding:</strong><br />
You should know about pandas DataFrames and basic Python syntax.</p>
</blockquote>
<h2 id="aim">Aim</h2>
<ul>
<li>Create Data Quality config files (YAML-based rule lists).</li>
<li>Run these configs directly against your DataFrames.</li>
<li>Manage your regex patterns from a single YAML file</li>
</ul>
<h2 id="1-reusing-example-data">1. Reusing Example Data</h2>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;John&quot;</span><span class="p">,</span> <span class="s2">&quot;Jane&quot;</span><span class="p">,</span> <span class="s2">&quot;Dave&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Missing&quot;</span><span class="p">],</span>
    <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">],</span>
    <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;john@example.com&quot;</span><span class="p">,</span>
        <span class="s2">&quot;jane@example.com&quot;</span><span class="p">,</span>
        <span class="s2">&quot;dave@example&quot;</span><span class="p">,</span>
        <span class="s2">&quot;test@test.com&quot;</span><span class="p">,</span>
        <span class="s2">&quot;alice@example.com&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">],</span>
    <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
    <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">datetime</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">})</span>
</code></pre></div>
<h2 id="2-yaml-config-files-for-data-quality-rules">2. YAML Config Files for Data Quality Rules</h2>
<h3 id="why-yaml">Why YAML?</h3>
<p>YAML is human-readable and machine-readable, well easier for a human to read than JSON anyway.</p>
<h3 id="key-structure">Key structure:</h3>
<ul>
<li>Overall metadata (e.g. dataset_name, measurement_time)
    <strong>all optional</strong></li>
<li>List of rules
    <strong>you must have at least one rule</strong> before you run the config.</li>
</ul>
<h3 id="example">Example:</h3>
<div class="highlight"><pre><span></span><code><span class="nt">dataset_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">My Source Data</span>
<span class="nt">measurement_sample</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10% of records</span>
<span class="nt">lifecycle_stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">field</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">id</span>
<span class="w">    </span><span class="nt">function</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">uniqueness</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">field</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">name</span>
<span class="w">    </span><span class="nt">na_values</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
<span class="w">    </span><span class="nt">function</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">validity_regex</span>
<span class="w">    </span><span class="nt">regex_pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;[A-z0-9_]&#39;</span>
</code></pre></div>
<h4 id="lists-in-yaml">Lists in YAML</h4>
<div class="highlight"><pre><span></span><code><span class="nt">valid_values</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">A</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">B</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">C</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">D</span><span class="p p-Indicator">]</span><span class="w">   </span><span class="c1"># simple</span>
<span class="nt">valid_values</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">A</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">B</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">C</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">D</span><span class="w">               </span><span class="c1"># verbose, useful for long lists</span>
</code></pre></div>
<h4 id="regex-in-yaml">Regex in YAML</h4>
<p>Always surround <code>regex_pattern</code> with <strong>single quotes</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">regex_pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;[A-Za-z]+&#39;</span>
<span class="nt">regex_pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;\d{4}-\d{2}-\d{2}&#39;</span>
<span class="nt">regex_pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;don</span><span class="se">&#39;&#39;</span><span class="s">t&#39;</span><span class="w">    </span><span class="c1"># To include a single quote</span>
</code></pre></div>
<h2 id="3-loading-and-validating-config-files">3. Loading and Validating Config Files</h2>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">gchq_data_quality</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataQualityConfig</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">DataQualityConfig</span><span class="o">.</span><span class="n">from_yaml</span><span class="p">(</span><span class="s2">&quot;your_config.yaml&quot;</span><span class="p">)</span>
</code></pre></div>
<p>You can load multiple files. </p>
<p>We find it makes sense to split your rules into separate files based on what you are measuring. For example, if you own a pet shop and have rules around pet details and customer details and orders, you might want a <code>dates.yaml</code> for storing rules relating to all your dates and <code>names.yaml</code> relating to rules for names of pets and owners:</p>
<div class="highlight"><pre><span></span><code><span class="n">config</span> <span class="o">=</span> <span class="n">DataQualityConfig</span><span class="o">.</span><span class="n">from_yaml</span><span class="p">([</span><span class="s1">&#39;dates.yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;names.yaml&#39;</span><span class="p">])</span>
</code></pre></div>
<h2 id="4-running-a-config-against-your-data">4. Running a Config Against Your Data</h2>
<p>Once your config is loaded:</p>
<div class="highlight"><pre><span></span><code><span class="n">report</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">(</span><span class="n">measurement_time_format</span><span class="o">=</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M&quot;</span><span class="p">))</span>
</code></pre></div>
<p>You can adjust config metadata programmatically. It can be useful to override <code>measurement_time</code>, as you may want to pretend the data was measured at the date of ingest, rather than when you actually measured it. It can help make sense of your analysis later to understand the quality of the data based on what it landed.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">timezone</span>

<span class="n">config</span><span class="o">.</span><span class="n">measurement_sample</span> <span class="o">=</span> <span class="s2">&quot;Test Sample&quot;</span>
<span class="n">config</span><span class="o">.</span><span class="n">dataset_name</span> <span class="o">=</span> <span class="s2">&quot;Overwrite Dataset Name&quot;</span>
<span class="n">config</span><span class="o">.</span><span class="n">measurement_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
</code></pre></div>
<h2 id="5-creating-a-config-file-from-a-report">5. Creating a Config File From a Report</h2>
<p>A typical workflow:
- Experiment with rules in Python
- Produce a DataQualityReport
- Extract those rules back into a deployable YAML config and modify
  - saves you writing out the entire YAML file from scratch</p>
<div class="highlight"><pre><span></span><code><span class="n">config_from_report</span> <span class="o">=</span> <span class="n">DataQualityConfig</span><span class="o">.</span><span class="n">from_report</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
<span class="n">config_from_report</span><span class="o">.</span><span class="n">to_yaml</span><span class="p">(</span><span class="s2">&quot;yaml_from_report.yaml&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<h2 id="6-mangaing-regular-expressions">6. Mangaing Regular Expressions</h2>
<p>Use a separate YAML file for regex patterns, to keep config rules readable and maintainable.</p>
<p><code>regex_patterns.yaml</code>:
<div class="highlight"><pre><span></span><code><span class="nt">EMAIL_REGEX</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$&#39;</span>
<span class="nt">PHONE_REGEX</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;[0-9]+&#39;</span>
</code></pre></div></p>
<p>Reference pattern names instead of raw regex in your rules:
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">field</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">email</span>
<span class="w">  </span><span class="nt">function</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">validity_regex</span>
<span class="w">  </span><span class="nt">regex_pattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">EMAIL_REGEX</span>
</code></pre></div></p>
<p>When loading your config:</p>
<div class="highlight"><pre><span></span><code><span class="n">config</span> <span class="o">=</span> <span class="n">DataQualityConfig</span><span class="o">.</span><span class="n">from_yaml</span><span class="p">(</span>
    <span class="s2">&quot;config_with_regex_refs.yaml&quot;</span><span class="p">,</span> 
    <span class="n">regex_yaml_path</span><span class="o">=</span><span class="s2">&quot;regex_patterns.yaml&quot;</span>
<span class="p">)</span>
</code></pre></div>
<h2 id="7-tweak-output-display-advanced">7. Tweak Output Display (Advanced)</h2>
<p>Control sample output size globally:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">gchq_data_quality.globals</span><span class="w"> </span><span class="kn">import</span> <span class="n">SampleConfig</span>
<span class="n">SampleConfig</span><span class="o">.</span><span class="n">RECORDS_FAILED_SAMPLE_SIZE</span> <span class="o">=</span> <span class="mi">25</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>